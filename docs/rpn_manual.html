import std/strutils
import nimib
import ./lib/codeOutput

var nbToc: NbBlock

template addToc =
  newNbBlock("nbText", false, nb, nbToc, ""):
    nbToc.output = "## 目录:\n\n"

template nbNewSection(name:string) =
  let anchorName = name.toLower.replace(" ", "-")
  nbText "<a name=\"" & anchorName & "\"></a>\n<br>\n### " & name & "\n\n---"
  nbToc.output.add "1. <a href=\"#" & anchorName & "\">" & name & "</a>\n"

template nbSubSection(name:string) =
  let anchorName = name.toLower.replace(" ", "-")
  nbText "<a name=\"" & anchorName & "\"></a>\n<br>\n#### " & name & "\n\n---"
  nbToc.output.add "    * <a href=\"#" & anchorName & "\">" & name & "</a>\n"

template nbQuoteBlock(code: untyped) =
  nbText "<blockquote>"
  code
  nbText "</blockquote>"

nbInit # ----------------------------- START ----------------------------------
initCodeTheme()


nbText: """
《Nim 语言教程（第一部分）》
======================================

- 作者：Andreas Rumpf
- 版本：2.1.1
- 原始翻译：[Morthan](https://habr.com/ru/users/Morthan/)
- 修订、更新、nimib 移植：[janAkali](https://codeberg.org/janAkali)

## 引言

> "Der Mensch ist doch ein Augentier -- Schöne Dinge wünsch' ich mir."
>
> （引自 Rammstein 乐队歌曲《Morgenstern》。大意译为："人类终究是视觉动物——我渴望美好之物"）

本文档是 Nim 编程语言的官方教程。

本教程假定您已熟悉编程的基本概念——变量、类型和运算符。

以下是其他学习 Nim 的资源（英文）：

* [Nim 基础](https://narimiran.github.io/nim-basics/) - 对上述概念的温和入门
* [5 分钟学会 Nim](https://learnxinyminutes.com/docs/nim/) - 5 分钟快速入门 Nim
* [Nim 官方手册](https://nim-lang.org/docs/manual.html) - 包含更多高级语言特性的示例

本教程中的所有代码示例，以及 Nim 其他文档中的示例，均遵循 Nim 语言风格指南。"""

addToc()

nbNewSection "你的第一个程序"

nbText: """
让我们从交互式程序开始 "Hello World":"""

nbCodeSkip:
  # 这是注释
  echo "你叫什么名字？ "
  var name: string = readLine(stdin)
  echo "你好, ", name, "!"

nbText: """
请将此代码保存到 `greetings.nim` 文件中，然后编译并运行它:
```bash
$ nim compile --run greetings.nim
```"""

nbQuoteBlock:
  nbText: """
  使用 [`--run`](https://nim-lang.org/docs/nimc.html#compiler-usage-commandminusline-switches") 选项时，Nim 会在编译完成后自动运行文件。您可以通过在文件名后添加参数来向程序传递命令行参数:
  ```bash
  $ nim compile --run greetings.nim 参数1 参数2
  ```
  """

nbQuoteBlock:
  nbText:"""
  常用命令和选项都有缩写形式，因此您可以使用以下任意一种写法:
  ```bash
  $ nim c greetings.nim # 将程序编译并保存到当前文件夹
  $ nim c -r greetings.nim # 将程序编译到当前文件夹并运行它
  ```

  如果您需要运行程序但不需要可执行文件（例如运行测试和短脚本时），请使用:
  ```bash
  $ nim r greetings.nim # 将程序编译到系统缓存文件夹并运行它
  ```
  所有可用的命令、选项及其缩写形式都可以在命令输出中查看:
  ```bash
  $ nim --fullhelp
  ```
  """

nbQuoteBlock:
  nbText:"""
  默认情况下，Nim 会在**调试**模式（debug）下编译代码。若要构建发布版本，请使用 `-d:release` 选项，该选项将启用优化功能:
  ```bash
  $ nim compile -d:release --run greetings.nim
  ```

  在进行基准测试和生产环境代码编译时，请使用 `-d:release` 选项。若需与 C 等"非安全"语言进行性能对比，请使用 `-d:danger` 编译开关以获得具有可比性的有效结果。否则，Nim 代码的性能可能会受运行时检查的限制——而这些检查在 C 语言中甚至根本不存在.
  """

nbText:"""
我们程序的功能应该相当明显，但请允许我解释语法规则：没有缩进的命令会在程序启动时执行。Nim 通过缩进来对命令进行分组。缩进只能使用空格符，不允许使用制表符.

字符串字面量使用双引号包裹。`var` 命令声明了一个名为 `name` 的字符串类型新变量，随后为其赋予由 `readLine` 过程返回的值。由于编译器知道 `readLine` 返回字符串类型，因此可以省略类型声明（这称为局部类型推断）。所以以下写法同样有效:"""

nbCodeSkip:
  var name = readLine(stdin) # name 因此可以省略类型声明 

nbQuoteBlock:
  nbText:"""
  需要注意的是——这几乎是 Nim 中唯一存在的类型推断形式：这种设计在简洁性和可读性之间取得了良好的平衡。
  """

nbText:"""
我们的 "hello world" 程序包含了一些编译器已预知的标识符：`echo`,`readLine` 等。这些内置命令声明在 `std/system` 模块中，该模块会被所有其他模块隐式导入。因此这个模块中的命令始终可用。"""

nbQuoteBlock:
  nbText:"""
  在nim语言中,一个由代码描述的程序通常被关键词`proc` 定义, 但由于有些`proc`的输入参数数量是开放的,例如:
  `echo 参数1, 参数2, 参数3 ...`, 通常会把此类`proc`称为命令(Command), 而`readLine(stdin)` 或 `stdin.readLine()` 则被称之为`函数`或`方法`. 
"""

nbSave # ----------------------------- END ------------------------------------


